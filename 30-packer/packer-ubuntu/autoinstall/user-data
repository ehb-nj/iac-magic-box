#cloud-config
autoinstall:
  version: 1
  refresh-installer:
    update: true
  apt:
    geoip: true
    preserve_sources_list: false
    primary:
    - arches: [amd64]
      uri: http://archive.ubuntu.com/ubuntu
  storage:
    version: 1
    config:
    - { id: vdisk, ptable: msdos, path: /dev/sda, wipe: superblock, grub_device: true, type: disk }

    # Linux boot partition (512MB)
    - { device: vdisk, size: 536870912, number: 1, flag: boot, type: partition, id: boot-partition }
    - { fstype: ext2, volume: boot-partition, type: format, id: boot-format }
    - { path: /boot, device: boot-format, type: mount, id: mount-boot }

    # Partition for LVM
    - { device: vdisk, size: -1, number: 2,type: partition, id: lvm-partition }
    - { name: vg0, devices: [ lvm-partition ], preserve: false, type: lvm_volgroup, id: lvm_volgroup-0 }

    # LV for root (12GB)
    - { name: sys, volgroup: lvm_volgroup-0, size: 12884901888, wipe: superblock, preserve: false, type: lvm_partition, id: lvm_partition-sys }
    - { fstype: xfs, volume: lvm_partition-sys, type: format, id: format-lvm-sys }
    - { path: /, device: format-lvm-sys, type: mount, id: mount-lvm-sys, options: "discard" }

    # LV for home (4GB)
    - { name: home, volgroup: lvm_volgroup-0, size: 4294967296, wipe: superblock, preserve: false, type: lvm_partition, id: lvm_partition-home }
    - { fstype: ext4, volume: lvm_partition-home, type: format, id: format-lvm-home }
    - { path: /home, device: format-lvm-home, type: mount, id: mount-lvm-home, options: "rw,nodev,nosuid" }

    # LV for tmp (2GB)
    - { name: tmp, volgroup: lvm_volgroup-0, size: 2147483648, wipe: superblock, preserve: false, type: lvm_partition, id: lvm_partition-tmp }
    - { fstype: ext4, volume: lvm_partition-tmp, type: format, id: format-lvm-tmp }
    - { path: /tmp, device: format-lvm-tmp, type: mount, id: mount-lvm-tmp, options: "rw,nodev,nosuid" }
    swap:
      size: 0
  ssh:
    allow_public_ssh_keys: true
    install-server: true
    ssh_quiet_keygen: true
  locale: en_US
  keyboard:
    layout: fr
  network:
    network:
      version: 2
      ethernets:
        enp6s18:
          dhcp4: true
  packages:
    - linux-image-virtual-hwe-22.04
    - qemu-guest-agent
    - sudo
    - xfsprogs
